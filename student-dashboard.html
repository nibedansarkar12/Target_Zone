<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Student Dashboard - Target Zone</title>

<!-- Tailwind -->
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">

<!-- SweetAlert -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<style>
/* Background Glow */
body {
    margin: 0;
    padding: 20px;
    background: radial-gradient(circle at top, #dbeafe, #e0f2fe, #ffffff);
    font-family: "Inter", sans-serif;
}

/* Floating Lights */
.light { position: fixed; width: 350px; height: 350px; filter: blur(120px); border-radius: 50%; z-index:-1; animation: float 8s infinite alternate ease-in-out; }
.light1 { background: rgba(99,102,241,0.25); top:10%; left:5%; }
.light2 { background: rgba(236,72,153,0.25); top:30%; left:60%; }
.light3 { background: rgba(14,165,233,0.25); top:70%; left:20%; }

@keyframes float { from { transform: translateY(0px); } to { transform: translateY(40px);} }

/* Premium Cards */
.glass-card {
    background: rgba(255,255,255,0.72);
    backdrop-filter: blur(15px);
    border-radius: 20px;
    padding: 25px;
    box-shadow: 0 12px 40px rgba(0,0,0,0.15);
}

.sec-title {
    font-size: 26px;
    font-weight: 800;
    margin-bottom: 12px;
    background: linear-gradient(90deg,#4f46e5,#9333ea);
    -webkit-background-clip: text;
    color: transparent;
}

/* Table */
.table-box { overflow-x: auto; }
th { background:#4f46e5; color:white; padding:10px; }
td { padding:10px; border-bottom:1px solid #e5e7eb; }

/* Exam Button */
.examBtn {
    background: linear-gradient(90deg,#4f46e5,#9333ea);
    color:white; padding:12px; width:100%; font-size:18px; 
    border-radius:14px; font-weight:700;
    box-shadow:0 8px 18px rgba(99,102,241,0.3);
}
</style>

</head>
<body>

<!-- BG Floating Lights -->
<div class="light light1"></div>
<div class="light light2"></div>
<div class="light light3"></div>

<div class="max-w-5xl mx-auto">

<h1 class="text-4xl font-extrabold text-center mb-6"
style="background:linear-gradient(90deg,#4f46e5,#9333ea);-webkit-background-clip:text;color:transparent;">
 üéì Student Dashboard
</h1>

<!-- STUDENT INFO -->
<div id="infoSection" class="glass-card hidden mb-6">
    <h2 class="sec-title">üìå ‡¶¨‡ßç‡¶Ø‡¶ï‡ßç‡¶§‡¶ø‡¶ó‡¶§ ‡¶§‡¶•‡ßç‡¶Ø</h2>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <p><strong>‡¶®‡¶æ‡¶Æ:</strong> <span id="name"></span></p>
        <p><strong>‡¶´‡ßã‡¶®:</strong> <span id="phone"></span></p>
        <p><strong>‡¶ú‡¶®‡ßç‡¶Æ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ:</strong> <span id="dob"></span></p>
        <p><strong>‡¶™‡¶ø‡¶§‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ:</strong> <span id="father"></span></p>
        <p><strong>‡¶¨‡ßç‡¶Ø‡¶æ‡¶ö:</strong> <span id="batch"></span></p>
        <p><strong>‡¶π‡ßã‡¶Ø‡¶º‡¶æ‡¶ü‡¶∏‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™:</strong> <span id="whatsapp"></span></p>
    </div>
</div>

<!-- PAYMENTS -->
<div id="paymentSection" class="glass-card hidden mb-6">
    <h2 class="sec-title">üí∞ ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡¶ø</h2>

    <div class="table-box">
        <table class="w-full">
            <thead>
                <tr>
                    <th>‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</th>
                    <th>‡¶Æ‡¶æ‡¶∏</th>
                    <th>‡¶ü‡¶æ‡¶ï‡¶æ</th>
                </tr>
            </thead>
            <tbody id="paymentTable"></tbody>
        </table>
    </div>
</div>

<!-- Exam -->
<div id="examSection" class="glass-card hidden mb-6">
    <h2 class="sec-title">üìù Exam</h2>
    <a href="quiz.html">
        <button class="examBtn">Go to Exam Page</button>
    </a>
</div>

</div>

<!-- Firebase -->
<script type="module">
import {
  initializeApp
} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";

import {
  getFirestore,
  doc,
  getDoc,
  collection,
  getDocs
} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

// Firebase config
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_AUTH",
  projectId: "YOUR_PROJECT_ID",
  storageBucket: "YOUR_BUCKET",
  messagingSenderId: "YOUR_MSG",
  appId: "YOUR_APP",
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// ======== Error Visible Logger ========
function showError(err, step = "") {
  console.error("üî• Dashboard Error (" + step + "):", err);

  Swal.fire({
    title: "Dashboard Error",
    html: `
      <b>Step:</b> ${step}<br><br>
      <b>Error:</b><br>${err?.message || err}
      <hr>
      <small>Check console for full details.</small>
    `,
    icon: "error",
  });
}

// ======== MAIN FUNCTION ========
async function loadDashboard() {
  try {
    console.log("üîµ Dashboard loading...");

    const url = new URL(window.location.href);
    const sid = url.searchParams.get("sid");
    console.log("üîµ SID =", sid);

    if (!sid) {
      showError("Missing SID in URL", "SID Validation");
      return;
    }

    // Step 1 ‚Äî Load student document
    let studentSnap;
    try {
      studentSnap = await getDoc(doc(db, "students", sid));
    } catch (err) {
      showError(err, "getDoc(students/sid)");
      return;
    }

    if (!studentSnap.exists()) {
      showError("Student Document Not Found in Firestore!", "Student Data Load");
      return;
    }

    const student = studentSnap.data();
    console.log("üü¢ Student Data:", student);

    // Fill DOM
    try {
      document.getElementById("sname").innerText = student.name || "N/A";
      document.getElementById("sid").innerText   = sid;
      document.getElementById("sdob").innerText  = student.dob || "N/A";
      document.getElementById("sphone").innerText = student.phone || "N/A";
      document.getElementById("sclass").innerText = student.class || "N/A";
      document.getElementById("saddress").innerText = student.address || "N/A";
    } catch (err) {
      showError(err, "Updating HTML Fields");
      return;
    }

    // Step 2 ‚Äî Payments / Subcollection
    console.log("üîµ Loading payments...");

    let paySnap;
    try {
      paySnap = await getDocs(collection(db, "students", sid, "payments"));
    } catch (err) {
      showError(err, "Loading Payment Collection");
      return;
    }

    const table = document.getElementById("paymentTableBody");
    table.innerHTML = "";

    paySnap.forEach((doc) => {
      const p = doc.data();
      console.log("üü¢ Payment record:", p);

      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${p?.amount || "N/A"}</td>
        <td>${p?.date || "N/A"}</td>
        <td>${p?.status || "N/A"}</td>
      `;
      table.appendChild(tr);
    });

    // Show Dashboard
    document.getElementById("infoSection").classList.remove("hidden");

    Swal.fire("Success", "Dashboard Loaded Successfully!", "success");

  } catch (err) {
    showError(err, "Main loadDashboard()");
  }
}

window.onload = loadDashboard;
      </script>
</body>
</html>
