<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Target Zone ‚Äì Signup (Final Clean Hybrid)</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- flatpickr -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

  <!-- SweetAlert2 -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <!-- lottie -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lottie-web/5.9.6/lottie.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

  <style>
    :root{
      --bg-1:#071024; --bg-2:#041122;
      --accent-1:#6366F1; --accent-2:#8B5CF6; --accent-3:#06B6D4;
    }
    *{box-sizing:border-box}
    body{
      margin:0; min-height:100vh;
      font-family:Inter,ui-sans-serif,system-ui,-apple-system,'Segoe UI',Roboto,'Helvetica Neue',Arial;
      color:#e6eef8;
      background: radial-gradient(900px 420px at 8% 12%, rgba(139,92,246,0.06), transparent),
                  linear-gradient(180deg,var(--bg-1),var(--bg-2));
      -webkit-font-smoothing:antialiased;
    }

    /* Background layers */
    .bg-layer{ position:fixed; inset:0; z-index:0; pointer-events:none; }
    .sun{ position:absolute; right:6%; top:6%; width:130px; height:130px; border-radius:50%;
      background: radial-gradient(circle at 30% 30%, #ffe27a 0%, #ffc938 60%, #ff9f1a 100%); filter:blur(.6px); opacity:0.92; mix-blend-mode:screen; animation: sunSpin 26s linear infinite; }
    @keyframes sunSpin{ from{ transform:rotate(0deg) } to{ transform:rotate(360deg) } }
    .cloud{ position:absolute; background:linear-gradient(180deg,#fff,#f3f4f6); border-radius:9999px; filter:blur(.7px); opacity:.85; box-shadow:0 30px 80px rgba(2,6,23,0.55) }
    .cloud.c1{ width:300px; height:84px; top:12%; left:-320px; animation:cloud1 120s linear infinite; }
    .cloud.c2{ width:200px; height:60px; top:44%; left:-260px; animation:cloud2 90s linear infinite; }
    @keyframes cloud1{ from{transform:translateX(0)} to{transform:translateX(160vw)} }
    @keyframes cloud2{ from{transform:translateX(0)} to{transform:translateX(140vw)} }

    /* floating blobs */
    .blob{ position:absolute; width:420px; height:420px; border-radius:50%; filter: blur(60px) saturate(120%); opacity:0.12; mix-blend-mode:screen; animation:blobFloat 18s ease-in-out infinite; }
    .blob.b1{ background:linear-gradient(90deg,#06B6D4,#8B5CF6); left:-6%; top:38% }
    .blob.b2{ background:linear-gradient(90deg,#FF6B6B,#FFD166); right:-10%; top:10%; opacity:0.08 }
    @keyframes blobFloat{ 0%{ transform:translateY(0) }50%{ transform:translateY(-24px) }100%{ transform:translateY(0) } }

    /* Container */
    .wrap{ position:relative; z-index:10; min-height:100vh; display:flex; align-items:center; justify-content:center; padding:40px 22px; }
    .content{ width:100%; max-width:1200px; display:grid; gap:24px; grid-template-columns: 1fr; }
    @media(min-width:960px){ .content{ grid-template-columns: 1fr 480px; } }

    /* Left column: feature list + live preview */
    .left{
      padding:22px; display:flex; flex-direction:column; gap:18px;
    }
    .brand{
      font-weight:800; font-size:28px;
      background:linear-gradient(90deg,var(--accent-1),var(--accent-2)); -webkit-background-clip:text; background-clip:text; color:transparent;
    }
    .lead{ color:#cfe7ff; opacity:0.9; max-width:44ch }

    /* Right: hybrid card wrapper */
    .card-wrap{ position:relative; }
    .main-card{
      border-radius:14px; padding:16px; background: linear-gradient(180deg, rgba(255,255,255,0.025), rgba(255,255,255,0.01));
      border:1px solid rgba(255,255,255,0.04); box-shadow:0 14px 50px rgba(2,6,23,0.6); backdrop-filter: blur(10px); overflow:visible; transition: transform .22s ease;
    }
    .main-card:hover{ transform:translateY(-6px); }

    /* mini-cards layout (facebook-style) */
    .mini-cards{ display:flex; flex-direction:column; gap:12px; }
    .mini{
      border-radius:12px; padding:12px; background: linear-gradient(180deg, rgba(255,255,255,0.015), rgba(255,255,255,0.01));
      border:1px solid rgba(255,255,255,0.03);
    }
    .mini h4{ font-weight:700; margin-bottom:6px; color:#e6eef8; }
    .mini p{ color:#cbd5e1; font-size:14px; margin:0 }

    /* collapsible inside the main card */
    .section{ border-radius:10px; margin-bottom:8px; overflow:hidden; border:1px solid rgba(255,255,255,0.03) }
    .section .head{ display:flex; align-items:center; justify-content:space-between; padding:10px 12px; cursor:pointer; background:linear-gradient(180deg, rgba(255,255,255,0.012), transparent); }
    .section .head h5{ margin:0; font-weight:700 }
    .section .body{ padding:12px; display:none; background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent) }
    .section.open .body{ display:block; }

    /* form fields */
    .field{ margin-top:8px; position:relative }
    .input, .select, .textarea{
      width:100%; padding:10px 12px; border-radius:10px; border:1px solid rgba(255,255,255,0.04); background:rgba(255,255,255,0.02); color:inherit;
    }
    label.flabel{ position:absolute; left:12px; top:10px; transform:translateY(0); font-size:13px; color:rgba(226,232,240,0.8); pointer-events:none }
    .small{ font-size:13px; color:#cbd5e1; margin-top:6px }

    /* password strength */
    .strength{ height:8px; background:rgba(255,255,255,0.04); border-radius:8px; overflow:hidden }
    .strength > span{ display:block; height:100%; width:0%; transition:width .28s; background:linear-gradient(90deg,#ef4444,#f59e0b,#10b981) }

    /* submit button morph */
    .btn{ display:inline-flex; align-items:center; justify-content:center; gap:8px; padding:10px 14px; border-radius:10px; cursor:pointer; font-weight:700; color:white; }
    .btn-primary{ background:linear-gradient(90deg,var(--accent-1),var(--accent-2)); box-shadow: 0 10px 35px rgba(99,102,241,0.12); border:none }
    .btn-google{ background:rgba(255,255,255,0.03); border:1px solid rgba(255,255,255,0.04); color:inherit }

    /* responsive */
    @media(max-width:960px){
      .content{ grid-template-columns: 1fr }
      .main-card{ margin-top:12px }
    }

    /* small helpers */
    .muted{ color:#9fb3d6; font-size:13px }
    .error{ box-shadow: 0 0 0 6px rgba(248,113,113,0.06); border-color: rgba(248,113,113,0.85) }

    /* reduced motion */
    @media (prefers-reduced-motion: reduce){
      .sun, .cloud, .blob, .main-card{ animation:none !important; transition:none !important }
    }
  </style>
</head>
<body>

  <div class="bg-layer" aria-hidden="true">
    <div class="sun"></div>
    <div class="cloud c1"></div>
    <div class="cloud c2"></div>
    <div class="blob b1"></div>
    <div class="blob b2"></div>
  </div>

  <div class="wrap">
    <div class="content">

      <!-- LEFT: intro + live theme preview small -->
      <div class="left">
        <div class="brand">üéØ Target Zone</div>
        <div class="lead">Sign up fast ‚Äî hybrid design: compact mini-cards + collapsible pro-card. Random themes & motion wallpaper included.</div>

        <div class="mini-cards">
          <div class="mini">
            <h4>Why join?</h4>
            <p class="small">Personalised mock tests, progress tracking, and a study community to keep you motivated.</p>
          </div>

          <div class="mini">
            <h4>Secure</h4>
            <p class="small">Firebase auth + friendly client-side validation.</p>
          </div>

          <div class="mini">
            <h4>Custom themes</h4>
            <p class="small">Random dynamic backgrounds on each load + motion wallpaper toggle.</p>
          </div>
        </div>

        <!-- quick controls for previewing themes -->
        <div style="margin-top:12px; display:flex; gap:8px; align-items:center; flex-wrap:wrap;">
          <button id="previewThemeBtn" class="btn btn-google" aria-label="Random theme">üîÅ Random Theme</button>
          <button id="toggleMotionBtn" class="btn btn-google">üì± Motion Wallpaper</button>
        </div>

      </div>

      <!-- RIGHT: hybrid main card -->
      <div class="card-wrap">
        <div class="main-card" id="mainCard" role="region" aria-label="Signup card">

          <!-- top mini row (facebook style) -->
          <div style="display:flex; gap:8px; margin-bottom:12px; flex-wrap:wrap;">
            <div class="mini" style="flex:1; min-width:160px">
              <h4>Personal</h4>
              <p class="small">Name, email, phone</p>
            </div>
            <div class="mini" style="flex:1; min-width:160px">
              <h4>Security</h4>
              <p class="small">Password & preferences</p>
            </div>
          </div>

          <!-- inside: collapsible sections -->
          <div id="sections">

            <!-- SECTION 1: PERSONAL -->
            <div class="section open" id="secPersonal">
              <div class="head" tabindex="0" role="button" aria-expanded="true" aria-controls="personalBody">
                <h5>Personal Info</h5>
                <div>‚ñº</div>
              </div>
              <div class="body" id="personalBody">
                <div class="field">
                  <label class="flabel">Full name *</label>
                  <input id="name" class="input" placeholder=" " required>
                </div>

                <div class="field" style="margin-top:10px;">
                  <label class="flabel">WhatsApp number *</label>
                  <input id="whatsapp" class="input" placeholder="10-digit or +countrycode" required>
                </div>

                <div class="field" style="margin-top:10px;">
                  <label class="flabel">Email *</label>
                  <input id="email" type="email" class="input" placeholder="you@example.com" required>
                </div>

                <div style="display:flex; gap:10px; margin-top:10px;">
                  <div style="flex:1">
                    <label class="flabel">Gender</label>
                    <select id="gender" class="select" style="padding:10px 12px;">
                      <option value="">Prefer not to say</option>
                      <option>Male</option>
                      <option>Female</option>
                      <option>Other</option>
                    </select>
                  </div>
                  <div style="flex:1">
                    <label class="flabel">Preferred language</label>
                    <select id="lang" class="select" style="padding:10px 12px;">
                      <option>‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ</option>
                      <option>English</option>
                      <option>‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</option>
                    </select>
                  </div>
                </div>

                <div style="display:flex; gap:10px; margin-top:10px;">
                  <div style="flex:1">
                    <label class="flabel">State</label>
                    <select id="state" class="select" style="padding:10px 12px;">
                      <option value="">Select state</option>
                      <option>West Bengal</option>
                      <option>Bihar</option>
                      <option>Odisha</option>
                      <option>Other</option>
                    </select>
                  </div>
                  <div style="flex:1">
                    <label class="flabel">District</label>
                    <input id="district" class="input" placeholder="District name">
                  </div>
                </div>

              </div>
            </div>

            <!-- SECTION 2: SECURITY -->
            <div class="section" id="secSecurity">
              <div class="head" tabindex="0" role="button" aria-expanded="false" aria-controls="securityBody">
                <h5>Security</h5>
                <div>‚ñº</div>
              </div>
              <div class="body" id="securityBody">
                <div class="field">
                  <label class="flabel">Password *</label>
                  <input id="password" type="password" class="input" placeholder="At least 8 characters" required>
                </div>

                <div class="field" style="margin-top:8px;">
                  <div class="strength"><span id="pwBar" style="width:0%"></span></div>
                  <div id="pwText" class="small">Type a password (min 8 chars)</div>
                </div>
              </div>
            </div>

            <!-- SECTION 3: ACADEMIC / EXAM -->
            <div class="section" id="secAcademic">
              <div class="head" tabindex="0" role="button" aria-expanded="false" aria-controls="academicBody">
                <h5>Academic / Exam Preferences</h5>
                <div>‚ñº</div>
              </div>
              <div class="body" id="academicBody">
                <div style="display:flex; gap:10px">
                  <div style="flex:1">
                    <label class="flabel">Education</label>
                    <select id="education" class="select">
                      <option>Madhyamik</option><option>HS</option><option>Graduate</option><option>Post Graduate</option><option>Other</option>
                    </select>
                  </div>
                  <div style="flex:1">
                    <label class="flabel">Current Status</label>
                    <select id="status" class="select">
                      <option>Student</option><option>Job Seeker</option><option>Employed</option>
                    </select>
                  </div>
                </div>

                <div style="margin-top:10px;">
                  <label class="flabel">Which exams are you preparing for?</label>
                  <div style="margin-top:8px; display:flex; gap:8px; flex-wrap:wrap;">
                    <label class="small"><input type="checkbox" class="examChk" value="WBPSC"> WBPSC</label>
                    <label class="small"><input type="checkbox" class="examChk" value="SSC"> SSC</label>
                    <label class="small"><input type="checkbox" class="examChk" value="Railway"> Railway</label>
                    <label class="small"><input type="checkbox" class="examChk" value="College"> College Exams</label>
                  </div>
                </div>

                <div style="margin-top:10px;">
                  <label class="flabel">Referral code (optional)</label>
                  <input id="referral" class="input" placeholder="If someone referred you">
                </div>
              </div>
            </div>

            <!-- SECTION 4: TERMS & FINISH -->
            <div class="section" id="secFinish">
              <div class="head" tabindex="0" role="button" aria-expanded="false" aria-controls="finishBody">
                <h5>Finish</h5>
                <div>‚ñº</div>
              </div>
              <div class="body" id="finishBody">
                <div style="display:flex; gap:8px; align-items:center;">
                  <label class="small"><input type="checkbox" id="subscribe"> Receive updates</label>
                  <label class="small" style="margin-left:8px"><input type="checkbox" id="terms" required> I agree to <a href="#" class="muted underline">Terms</a></label>
                </div>

                <div style="margin-top:12px; display:flex; gap:8px;">
                  <button id="submitBtn" class="btn btn-primary" type="button">‚úÖ Create account</button>
                  <button id="googleBtn" class="btn btn-google" type="button">üîë Sign up with Google</button>
                </div>

                <div id="statusMsg" class="small" style="margin-top:8px;color:#bcd">Status messages appear here</div>
              </div>
            </div>

          </div> <!-- /sections -->

        </div> <!-- /main-card -->
      </div> <!-- /card-wrap -->

    </div> <!-- /content -->
  </div> <!-- /wrap -->

  <!-- Firebase imports -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getAuth, createUserWithEmailAndPassword, GoogleAuthProvider, signInWithPopup } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    // Firebase config (keep your values)
    const firebaseConfig = {
      apiKey: "AIzaSyCR5rqthBh0vX0yLOcOG3b9xJiKbYtzdxU",
      authDomain: "target-zone-8fffd.firebaseapp.com",
      projectId: "target-zone-8fffd",
      storageBucket: "target-zone-8fffd.appspot.com",
      messagingSenderId: "667579216123",
      appId: "1:667579216123:web:37bb1fcc724743073d005e"
    };
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // DOM refs
    const sections = document.getElementById('sections');
    const secHeads = document.querySelectorAll('.section .head');
    const submitBtn = document.getElementById('submitBtn');
    const googleBtn = document.getElementById('googleBtn');
    const statusMsg = document.getElementById('statusMsg');
    const previewThemeBtn = document.getElementById('previewThemeBtn');
    const toggleMotionBtn = document.getElementById('toggleMotionBtn');
    const mainCard = document.getElementById('mainCard');

    // form fields
    const nameField = document.getElementById('name');
    const waField = document.getElementById('whatsapp');
    const emailField = document.getElementById('email');
    const pwdField = document.getElementById('password');
    const education = document.getElementById('education');
    const statusSel = document.getElementById('status');
    const subscribe = document.getElementById('subscribe');
    const terms = document.getElementById('terms');
    const referral = document.getElementById('referral');

    // ---------------- Collapsible behaviour ----------------
    secHeads.forEach(h=>{
      h.addEventListener('click', ()=> {
        const sec = h.parentElement;
        const open = sec.classList.toggle('open');
        h.setAttribute('aria-expanded', open ? 'true' : 'false');
      });
      // keyboard accessible
      h.addEventListener('keydown', (e)=> { if(e.key === 'Enter' || e.key === ' ') { e.preventDefault(); h.click(); } });
    });

    // ---------------- Password strength ----------------
    function evalPw(pw){
      let sc=0;
      if(!pw) return {score:0,pct:0,label:'Type a password'};
      if(pw.length>=8) sc++;
      if(/[A-Z]/.test(pw)) sc++;
      if(/[a-z]/.test(pw)) sc++;
      if(/\d/.test(pw)) sc++;
      if(/[^A-Za-z0-9]/.test(pw)) sc++;
      const pct = Math.round((sc/5)*100);
      let label='Weak';
      if(sc>=4) label='Strong';
      else if(sc>=2) label='Medium';
      return {score:sc,pct,label};
    }
    pwdField.addEventListener('input', ()=>{
      const r = evalPw(pwdField.value);
      document.getElementById('pwBar').style.width = r.pct + '%';
      document.getElementById('pwText').textContent = r.label === 'Weak' ? 'Weak ‚Äî add uppercase, numbers, symbols' : (r.label === 'Medium' ? 'Medium ‚Äî almost there' : 'Strong ‚Äî good to go');
    });

    // ---------------- Random theme & motion wallpaper ----------------
    const themes = [
      { name:'aurora', bg:'radial-gradient(900px 400px at 6% 12%, rgba(139,92,246,0.06), transparent), linear-gradient(180deg,#071024,#041122)' },
      { name:'neon', bg:'radial-gradient(600px 240px at 90% 20%, rgba(6,182,212,0.06), transparent), linear-gradient(180deg,#071024,#09132a)' },
      { name:'sunset', bg:'radial-gradient(700px 300px at 10% 80%, rgba(255,160,100,0.06), transparent), linear-gradient(180deg,#0a1729,#231227)' },
      { name:'galaxy', bg:'radial-gradient(900px 400px at 20% 20%, rgba(255,120,200,0.04), transparent), linear-gradient(180deg,#020617,#081026)' }
    ];
    function applyRandomTheme(){
      const t = themes[Math.floor(Math.random()*themes.length)];
      document.body.style.background = t.bg;
      mainCard.style.borderColor = 'rgba(255,255,255,0.045)';
    }
    previewThemeBtn.addEventListener('click', applyRandomTheme);

    let motionOn = true;
    toggleMotionBtn.addEventListener('click', ()=>{
      motionOn = !motionOn;
      document.querySelectorAll('.blob').forEach(b=> b.style.display = motionOn ? 'block' : 'none');
      toggleMotionBtn.textContent = motionOn ? 'üì± Motion Wallpaper' : 'üìµ Motion OFF';
    });

    // on load apply a random theme
    applyRandomTheme();

    // rotate background every N seconds (gentle)
    setInterval(()=> {
      if(Math.random() < 0.45) applyRandomTheme();
    }, 8000);

    // ---------------- Simple form validation ----------------
    function gatherForm(){
      const exams = Array.from(document.querySelectorAll('.examChk:checked')).map(n=>n.value);
      return {
        name: nameField.value.trim(),
        whatsapp: waField.value.trim(),
        email: emailField.value.trim(),
        password: pwdField.value,
        gender: document.getElementById('gender').value,
        language: document.getElementById('lang').value,
        state: document.getElementById('state').value,
        district: document.getElementById('district').value,
        education: education.value,
        status: statusSel.value,
        exams,
        referral: referral.value.trim(),
        subscribe: subscribe.checked
      };
    }

    function validateAll(data){
      if(!data.name) return 'Please enter your name';
      if(!/^\S+@\S+\.\S+$/.test(data.email)) return 'Enter a valid email';
      const digits = (data.whatsapp || '').replace(/\D/g,'');
      if(!( /^\d{10}$/.test(digits) || /^\d{11,13}$/.test(digits) )) return 'Enter a valid WhatsApp number';
      if(!data.password || data.password.length < 8) return 'Password must be at least 8 characters';
      if(!terms.checked) return 'You must agree to Terms';
      return null;
    }

    // ---------------- Submit (Firebase) ----------------
    submitBtn.addEventListener('click', async ()=>{
      const data = gatherForm();
      const v = validateAll(data);
      if(v){
        Swal.fire({ icon:'error', title:'Validation', text: v });
        return;
      }

      // micro-loading
      submitBtn.textContent = 'Processing‚Ä¶';
      submitBtn.disabled = true;
      statusMsg.textContent = 'Creating account‚Ä¶';

      try{
        // Create Firebase user
        const cred = await createUserWithEmailAndPassword(auth, data.email, data.password);
        // Save profile to Firestore (no photo, no OTP)
        await addDoc(collection(db, 'users'), {...data, uid: cred.user.uid, createdAt: serverTimestamp()});
        // success
        Swal.fire({ icon:'success', title:'Signup successful!', showConfirmButton:false, timer:1400 });

        // small lottie success (non-blocking)
        const animDiv = document.createElement('div');
        animDiv.style.width='86px'; animDiv.style.height='86px'; animDiv.style.margin='14px auto';
        document.querySelector('.main-card').appendChild(animDiv);
        lottie.loadAnimation({ container: animDiv, renderer:'svg', loop:false, autoplay:true, path:'https://assets3.lottiefiles.com/packages/lf20_jbrw3hcz.json' });

        // redirect (simulate)
        setTimeout(()=>{ window.location.href = 'exam.html'; }, 1400);
      } catch(err){
        console.error(err);
        Swal.fire({ icon:'error', title:'Signup failed', text: err && err.message ? err.message : 'Unknown error' });
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = '‚úÖ Create account';
        statusMsg.textContent = '';
      }
    });

    // ---------------- Google Sign In (Firebase) ----------------
    googleBtn.addEventListener('click', async ()=>{
      const provider = new GoogleAuthProvider();
      try{
        const res = await signInWithPopup(auth, provider);
        const user = res.user;
        await addDoc(collection(db, 'users'), { uid: user.uid, name: user.displayName || '', email: user.email || '', google:true, createdAt: serverTimestamp() });
        Swal.fire({ icon:'success', title:'Signed in with Google', showConfirmButton:false, timer:1200 });
        window.location.href = 'exam.html';
      } catch(err){
        console.error(err);
        Swal.fire({ icon:'error', title:'Google sign-in failed', text: err && err.message ? err.message : 'Unknown error' });
      }
    });

    // Accessibility: keyboard focus ring
    document.body.addEventListener('keydown', (e)=> { if(e.key === 'Tab') document.documentElement.classList.add('user-is-tabbing'); });

    // small helper: remove error class on input
    document.querySelectorAll('.input, .select').forEach(el=>{
      el.addEventListener('input', ()=> el.classList.remove('error'));
    });

  </script>

  <!-- Attribution -->
  <!-- Base / starting point: original signup.html provided by user. Reference: Ó®Å1Ó®Ç -->
</body>
</html>
