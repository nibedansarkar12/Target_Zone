<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Target Zone â€“ Signup</title>

  <!-- Tailwind + SweetAlert -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <style>
    :root { --glass: rgba(255,255,255,.86); }
    body { font-family: Inter, system-ui, Arial; background: linear-gradient(180deg,#eef2ff,#ffffff); }
    .card { max-width:820px; margin:40px auto; background:var(--glass); padding:28px; border-radius:14px; box-shadow:0 20px 50px rgba(15,23,42,0.06); }
    .muted{color:#6b7280}
  </style>
</head>
<body>
  <div class="card">
    <div class="flex items-center justify-between mb-6">
      <h1 class="text-2xl font-bold">ðŸŽ¯ Target Zone â€” Signup</h1>
      <div class="muted">Secure Â· Fast Â· Simple</div>
    </div>

    <form id="signupForm" class="grid grid-cols-1 gap-4">
      <input id="name" placeholder="Full Name *" class="border rounded px-4 py-2" required />
      <input id="phone" placeholder="Phone (01XXXXXXXXX) *" inputmode="tel" class="border rounded px-4 py-2" required />
      <input id="email" type="email" placeholder="Email *" class="border rounded px-4 py-2" required />
      <input id="dob" placeholder="Date of birth (YYYY-MM-DD) *" class="border rounded px-4 py-2" required />
      <input id="password" type="password" placeholder="Password * (min 8 chars)" class="border rounded px-4 py-2" required />
      <div class="flex gap-2">
        <button id="submitBtn" class="flex-1 bg-indigo-600 text-white rounded px-4 py-2 font-semibold">Sign up</button>
        <button id="googleBtn" type="button" class="flex-1 border rounded px-4 py-2">Sign up with Google</button>
      </div>
    </form>

    <p class="mt-4 muted text-sm">Already have an account? <a href="login.html" class="text-indigo-600 underline">Login</a></p>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getAuth, createUserWithEmailAndPassword, GoogleAuthProvider, signInWithPopup } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCR5rqthBh0vX0yLOcOG3b9xJiKbYtzdxU",
      authDomain: "target-zone-8fffd.firebaseapp.com",
      projectId: "target-zone-8fffd",
      storageBucket: "target-zone-8fffd.appspot.com",
      messagingSenderId: "667579216123",
      appId: "1:667579216123:web:37bb1fcc724743073d005e"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    const form = document.getElementById("signupForm");
    const submitBtn = document.getElementById("submitBtn");
    const googleBtn = document.getElementById("googleBtn");

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      submitBtn.disabled = true;
      submitBtn.textContent = "Processing...";

      const name = document.getElementById("name").value.trim();
      const phone = document.getElementById("phone").value.trim();
      const email = document.getElementById("email").value.trim();
      const dob = document.getElementById("dob").value.trim();
      const password = document.getElementById("password").value;

      if (!name || !phone || !email || !dob || password.length < 8) {
        Swal.fire({icon:'error',title:'Invalid input',text:'à¦…à¦¨à§à¦—à§à¦°à¦¹ à¦•à¦°à§‡ à¦¸à¦¬ à¦«à¦¿à¦²à§à¦¡ à¦¸à¦ à¦¿à¦•à¦­à¦¾à¦¬à§‡ à¦ªà§‚à¦°à¦£ à¦•à¦°à§à¦¨ (password >= 8)'}); 
        submitBtn.disabled = false; submitBtn.textContent = "Sign up";
        return;
      }

      try {
        // 1) Create auth user
        const cred = await createUserWithEmailAndPassword(auth, email, password);
        const user = cred.user;

        // 2) Create student record and link email & uid
        const docRef = await addDoc(collection(db, "students"), {
          name,
          phone,
          email,
          uid: user.uid,
          dob,
          createdAt: serverTimestamp()
        });

        Swal.fire({icon:'success',title:'Signup complete',text:'à¦†à¦ªà¦¨à¦¾à¦° à¦à¦•à¦¾à¦‰à¦¨à§à¦Ÿ à¦¤à§ˆà¦°à¦¿ à¦¹à¦¯à¦¼à§‡à¦›à§‡à¥¤',timer:1500,showConfirmButton:false});
        // 3) Redirect to dashboard with sid (prevents 404)
        setTimeout(()=> {
          location.href = `student-dashboard.html?sid=${docRef.id}`;
        }, 1200);

      } catch (err) {
        Swal.fire({icon:'error',title:'Signup failed',text:err.message || String(err)});
        submitBtn.disabled = false; submitBtn.textContent = "Sign up";
      }
    });

    // Google signup button â€” will create / link student doc too
    googleBtn.addEventListener("click", async () => {
      googleBtn.disabled = true;
      googleBtn.textContent = "Processing...";
      try {
        const provider = new GoogleAuthProvider();
        const res = await signInWithPopup(auth, provider);
        const user = res.user;

        // Create a student doc linked to this google user (if you want deduplication,
        // you can first query students by email â€” left simple here)
        const docRef = await addDoc(collection(db, "students"), {
          name: user.displayName || "",
          phone: user.phoneNumber || "",
          email: user.email || "",
          uid: user.uid,
          createdAt: serverTimestamp(),
          google: true
        });

        Swal.fire({icon:'success',title:'Signup complete',timer:1200,showConfirmButton:false});
        setTimeout(()=> location.href = `student-dashboard.html?sid=${docRef.id}`, 900);

      } catch (err) {
        Swal.fire({icon:'error',title:'Google signup failed',text: err.message || String(err)});
        googleBtn.disabled = false; googleBtn.textContent = "Sign up with Google";
      }
    });
  </script>
</body>
</html>
