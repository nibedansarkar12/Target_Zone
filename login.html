<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>Target Zone ‚Äì Login</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      min-height: 100vh; margin: 0; padding: 24px 12px;
      background: linear-gradient(to bottom, #87cefa, #e0f7fa);
      background-attachment: fixed; overflow-x: hidden; position: relative;
      transition: background .3s ease;
    }
    body.dark { background: linear-gradient(to bottom, #0f172a, #1e293b); color:#e2e8f0; }

    /* Sun + Clouds */
    .sun { position: fixed; top: 5%; right: 8%; width: 130px; height: 130px; border-radius: 50%;
      background: radial-gradient(circle at 40% 40%, #ffe27a 0%, #ffc938 55%, #ff9f1a 100%);
      box-shadow:0 0 60px rgba(255,200,0,.55),0 0 120px rgba(255,180,0,.35);
      animation:sunPulse 6s ease-in-out infinite alternate; z-index:1; }
    @keyframes sunPulse { from{transform:scale(1)} to{transform:scale(1.08)} }
    .cloud { position: fixed; background:#fff; border-radius:50%; opacity:.7;
      animation: float linear infinite; box-shadow:40px 20px 60px rgba(0,0,0,.08); z-index:2; }
    .cloud.one { width:220px; height:68px; top:18%; left:-260px; animation-duration:75s; }
    .cloud.two { width:170px; height:56px; top:38%; left:-220px; animation-duration:95s; }
    .cloud.three { width:280px; height:80px; top:62%; left:-320px; animation-duration:115s; }
    @keyframes float { from{transform:translateX(0)} to{transform:translateX(120vw)} }

    /* Form */
    .form-card { background:rgba(255,255,255,.68); backdrop-filter:blur(12px); border-radius:1.5rem;
      box-shadow:0 20px 50px rgba(0,0,0,.2); transition:all .25s ease; position:relative; z-index:5; }
    .form-card:hover { background:rgba(255,255,255,.92); transform:translateY(-2px) scale(1.01); }

    /* Inputs */
    .t-input { background:rgba(255,255,255,.7); border:1px solid rgba(0,0,0,.12); transition:.25s }
    .t-input:focus { background:#fff; border-color:#4facfe; box-shadow:0 0 0 4px rgba(79,172,254,.28); outline:none }
    .t-input::placeholder { animation:pulsePlaceholder 2s infinite; }
    @keyframes pulsePlaceholder { 0%,100%{opacity:.7} 50%{opacity:1} }
    .input-error { border-color:#f87171 !important; box-shadow:0 0 0 3px rgba(248,113,113,.2) }

    /* Glow button */
    .btn-glow{ transition:.3s; position:relative; overflow:hidden; }
    .btn-glow::after{ content:""; position:absolute; inset:0; border-radius:inherit;
      box-shadow:0 0 15px 3px rgba(79,172,254,.6); opacity:0; transition:.3s; }
    .btn-glow:hover::after{ opacity:1; }

    /* Toggle pills - subtle, preserves original design */
    .login-toggle { display:flex; gap:6px; justify-content:center; margin-bottom:10px; }
    .toggle-pill { padding:6px 12px; border-radius:999px; cursor:pointer; font-weight:600; font-size:0.95rem;
                  border:1px solid rgba(0,0,0,0.06); background:rgba(255,255,255,0.6); }
    .toggle-pill.active { background:linear-gradient(90deg,#6366f1,#8b5cf6); color:white; box-shadow:0 6px 20px rgba(99,102,241,0.15); }
  </style>
</head>
<body>
  <!-- Background -->
  <div class="sun"></div>
  <div class="cloud one"></div>
  <div class="cloud two"></div>
  <div class="cloud three"></div>

  <!-- Dark mode toggle -->
  <div class="fixed top-4 right-4 z-50">
    <button id="themeToggle" class="bg-gray-200 dark:bg-gray-700 p-2 rounded-full">üåô</button>
  </div>

  <!-- Login Form -->
  <div class="flex items-center justify-center min-h-screen">
    <div class="form-card p-6 md:p-8 w-full max-w-md mx-auto">
      <h2 class="text-3xl font-extrabold text-center mb-4 bg-gradient-to-r from-blue-600 to-indigo-500 bg-clip-text text-transparent">
        üîê Target Zone ‚Äì Login
      </h2>

      <!-- Toggle pills (UID / Email) - keeps design intact, small and subtle -->
      <div class="login-toggle">
        <div id="pill-uid" class="toggle-pill active">UID Login</div>
        <div id="pill-email" class="toggle-pill">Email Login</div>
      </div>

      <form id="loginForm" class="grid grid-cols-1 gap-4" novalidate>
        <!-- UID block (hidden when Email mode) -->
        <div id="uidBlock" class="">
          <input id="uid" type="text" class="t-input px-4 py-3 rounded-lg shadow-sm" placeholder="üé´ UID" />
          <input id="uid_password" type="password" class="t-input px-4 py-3 rounded-lg shadow-sm" placeholder="üîë Password" />
          <button id="uidLoginBtn" type="button" class="btn-glow w-full bg-gradient-to-r from-indigo-500 to-purple-600 hover:from-purple-600 hover:to-indigo-600 text-white py-3 rounded-lg font-semibold text-lg">
            Login with UID
          </button>
        </div>

        <!-- Email block (hidden when UID mode) -->
        <div id="emailBlock" class="hidden">
          <input id="emailInput" type="email" class="t-input px-4 py-3 rounded-lg shadow-sm" placeholder="üìß Email *" />
          <div class="relative">
            <input id="emailPass" type="password" class="t-input w-full px-4 py-3 rounded-lg shadow-sm pr-10" placeholder="üîê Password *" />
            <span id="togglePw" class="absolute right-3 top-3 cursor-pointer">üëÅÔ∏è</span>
          </div>
          <label class="flex items-center gap-2">
            <input type="checkbox" id="remember" class="mt-1">
            <span class="text-sm">Remember me</span>
          </label>

          <button id="emailLoginBtn" type="button" class="btn-glow w-full bg-gradient-to-r from-indigo-500 to-purple-600 hover:from-purple-600 hover:to-indigo-600 text-white py-3 rounded-lg font-semibold text-lg">
            ‚úÖ Login
          </button>
        </div>

        <!-- Google button (always shown, preserved exact look) -->
        <button id="googleBtn" type="button"
          class="w-full mt-1 flex items-center justify-center gap-3 border border-gray-300 bg-white hover:bg-gray-100 text-gray-700 py-3 rounded-lg font-medium shadow-sm transition">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48" class="w-5 h-5"><path fill="#EA4335" d="M24 9.5c3.54 0 6.63 1.22 9.1 3.61l6.77-6.77C35.42 2.89 30.18.5 24 .5 14.83.5 7.08 6.42 3.96 14.74l7.91 6.14C13.61 15.1 18.41 9.5 24 9.5z"/><path fill="#4285F4" d="M46.98 24.5c0-1.6-.14-3.13-.4-4.59H24v9.1h12.9c-.56 3.01-2.25 5.56-4.81 7.27l7.64 5.94C44.11 38.27 46.98 31.89 46.98 24.5z"/><path fill="#FBBC05" d="M11.87 28.88a14.46 14.46 0 0 1 0-9.76l-7.91-6.14a23.92 23.92 0 0 0 0 22.04l7.91-6.14z"/><path fill="#34A853" d="M24 47.5c6.18 0 11.42-2.04 15.23-5.54l-7.64-5.94c-2.12 1.43-4.83 2.28-7.59 2.28-5.59 0-10.39-5.6-12.13-11.38l-7.91 6.14C7.08 42.58 14.83 47.5 24 47.5z"/></svg>
          Sign in with Google
        </button>

      </form>

      <!-- Signup link -->
      <p class="text-center mt-4 text-sm">
        üë§ ‡¶è‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶®‡ßá‡¶á?
        <a href="signup.html" class="text-blue-600 font-semibold hover:underline">
          ‡¶∏‡¶æ‡¶á‡¶® ‡¶Ü‡¶™ ‡¶ï‡¶∞‡ßÅ‡¶®
        </a>
      </p>

      <!-- Admin Login link -->
      <p class="text-center mt-3">
        <a href="admin-login.html"
           class="inline-block px-4 py-2 text-sm font-medium text-indigo-600 dark:text-indigo-300 border border-indigo-300 dark:border-indigo-600 rounded-lg hover:bg-indigo-100 dark:hover:bg-indigo-800 transition">
          üõ†Ô∏è ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶≤‡¶ó‡¶á‡¶®
        </a>
      </p>
    </div>
  </div>

  <!-- Firebase Login -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getAuth, signInWithEmailAndPassword, GoogleAuthProvider, signInWithPopup } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import { getFirestore, collection, query, where, getDocs, doc, setDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig={apiKey:"AIzaSyCR5rqthBh0vX0yLOcOG3b9xJiKbYtzdxU",authDomain:"target-zone-8fffd.firebaseapp.com",projectId:"target-zone-8fffd",storageBucket:"target-zone-8fffd.appspot.com",messagingSenderId:"667579216123",appId:"1:667579216123:web:37bb1fcc724743073d005e"};
    const app=initializeApp(firebaseConfig);
    const auth=getAuth(app);
    const db=getFirestore(app);

    // theme toggle
    document.getElementById("themeToggle")?.addEventListener("click", ()=> document.body.classList.toggle("dark"));

    // show/hide password icon for email block
    document.getElementById("togglePw")?.addEventListener("click", ()=>{
      const p = document.getElementById("emailPass");
      if (!p) return;
      p.type = p.type === "password" ? "text" : "password";
    });

    // Toggle pills logic (preserve design: just show/hide blocks)
    const pillUid = document.getElementById("pill-uid");
    const pillEmail = document.getElementById("pill-email");
    const uidBlock = document.getElementById("uidBlock");
    const emailBlock = document.getElementById("emailBlock");

    function setMode(mode) {
      if (mode === "uid") {
        pillUid.classList.add("active");
        pillEmail.classList.remove("active");
        uidBlock.classList.remove("hidden");
        emailBlock.classList.add("hidden");
      } else {
        pillEmail.classList.add("active");
        pillUid.classList.remove("active");
        emailBlock.classList.remove("hidden");
        uidBlock.classList.add("hidden");
      }
    }

    pillUid.addEventListener("click", ()=> setMode("uid"));
    pillEmail.addEventListener("click", ()=> setMode("email"));

    // initialize default (UID active) to keep similar UX
    setMode("uid");

    /* ---------------------------
       UID Login handler
       --------------------------- */
    document.getElementById("uidLoginBtn").addEventListener("click", async ()=> {
      const uidVal = document.getElementById("uid").value.trim();
      const pwd = document.getElementById("uid_password").value.trim();
      // small validation
      if (!uidVal || !pwd) {
        Swal.fire({icon:"error", title:"UID & Password ‡¶¶‡¶∞‡¶ï‡¶æ‡¶∞"});
        return;
      }
      try {
        const q = query(collection(db,"students"), where("uid","==",uidVal), where("password","==",pwd));
        const snap = await getDocs(q);
        if (snap.empty) {
          Swal.fire({icon:"error", title:"Login Failed", text:"‡¶≠‡ßÅ‡¶≤ UID ‡¶¨‡¶æ Password"});
          return;
        }
        const studentId = snap.docs[0].id;
        localStorage.setItem("studentId", studentId);
        Swal.fire({icon:"success", title:"Login Successful", timer:1200, showConfirmButton:false});
        setTimeout(()=> location.href = "student-dashboard.html", 1200);
      } catch (err) {
        console.error(err);
        Swal.fire({icon:"error", title:"Login Error", text: err.message || err});
      }
    });

    /* ---------------------------
       Email Login handler
       --------------------------- */
    document.getElementById("emailLoginBtn").addEventListener("click", async ()=> {
      const email = document.getElementById("emailInput").value.trim();
      const pwd = document.getElementById("emailPass").value;
      if (!email || !pwd) { Swal.fire({icon:"error", title:"Email ‡¶ì Password ‡¶¶‡¶∞‡¶ï‡¶æ‡¶∞"}); return; }
      try {
        await signInWithEmailAndPassword(auth, email, pwd);
        // redirect to dashboard (dashboard will decide whether to show UID-link box)
        Swal.fire({icon:"success", title:"Login Successful", timer:1200, showConfirmButton:false});
        setTimeout(()=> location.href = "student-dashboard.html", 1000);
      } catch (err) {
        console.error(err);
        Swal.fire({icon:"error", title:"Login Failed", text: err.message || err});
      }
    });

    /* ---------------------------
       Google login handler (kept exactly same behaviour)
       --------------------------- */
    document.getElementById("googleBtn").addEventListener("click", async ()=> {
      const provider = new GoogleAuthProvider();
      try {
        const res = await signInWithPopup(auth, provider);
        const user = res.user;
        // ensure a record in 'users' (non-intrusive)
        await setDoc(doc(db, "users", user.uid), {
          uid: user.uid,
          name: user.displayName || "",
          email: user.email || "",
          createdAt: serverTimestamp(),
          google: true
        }, { merge: true });
        Swal.fire({icon:"success", title:"Google Login Successful", timer:1200, showConfirmButton:false});
        setTimeout(()=> location.href = "student-dashboard.html", 1000);
      } catch (err) {
        console.error(err);
        Swal.fire({icon:"error", title:"Google Login Failed", text: err.message || err});
      }
    });
  </script>
</body>
</html>
