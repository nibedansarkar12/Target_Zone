<!doctype html>
<html lang="bn">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Target Zone ‚Äî Login</title>

  <!-- Tailwind -->
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">

  <!-- SweetAlert -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <style>
    :root{
      --accent1:#6d28d9;
      --accent2:#8b5cf6;
    }
    body{
      font-family:"Inter",sans-serif;
      background:linear-gradient(180deg,#c7f0ff,#eaf7ff,#f6fbff);
      min-height:100vh;
      display:flex;
      justify-content:center;
      align-items:center;
      padding:30px;
    }

    .card{
      width:100%;
      max-width:900px;
      display:flex;
      gap:30px;
      padding:30px;
      background:rgba(255,255,255,0.85);
      backdrop-filter:blur(10px);
      box-shadow:0 20px 40px rgba(0,0,0,0.12);
      border-radius:20px;
    }

    .logo-img{
      max-width:180px;
      object-fit:contain;
      border-radius:12px;
    }

    @media(max-width:850px){
      .card{flex-direction:column;align-items:center;text-align:center;}
    }

    .pill{
      padding:8px 15px;
      border-radius:999px;
      cursor:pointer;
      font-weight:600;
    }
    .pill.active{
      background:linear-gradient(90deg,var(--accent1),var(--accent2));
      color:white;
      box-shadow:0 8px 20px rgba(99,102,241,0.18);
    }

    .input{
      width:100%;
      padding:12px 14px;
      border-radius:12px;
      border:1px solid rgba(0,0,0,0.15);
      background:white;
      font-size:15px;
    }

    .action-btn{
      width:100%;
      padding:12px;
      border-radius:12px;
      color:white;
      font-size:16px;
      background:linear-gradient(90deg,var(--accent1),var(--accent2));
      font-weight:700;
    }
  </style>

</head>
<body>

  <div class="card">

    <!-- LEFT LOGO -->
    <div class="flex justify-center items-center w-full">
      <img class="logo-img"
        src="https://raw.githubusercontent.com/nibedansarkar12/Target_Zone/main/target-zone-high-resolution-logo-black.png">
    </div>

    <!-- RIGHT FORM -->
    <div class="w-full">

      <h2 class="text-2xl font-bold text-gray-800 mb-3">Target Zone ‚Äî Login</h2>

      <!-- TOGGLE -->
      <div class="flex gap-3 mb-4">
        <div id="pillUID" class="pill active">Phone Login</div>
        <div id="pillEmail" class="pill">Email Login</div>
      </div>

      <!-- PHONE + DOB LOGIN -->
      <div id="formUID">

        <input id="inputPhone" class="input mb-3" placeholder="‡¶´‡ßã‡¶® ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®">

        <div class="relative mb-3">
          <input id="inputDob" class="input pr-10" type="password" placeholder="‡¶ú‡¶®‡ßç‡¶Æ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ (YYYY-MM-DD)">
          <span id="toggleDob" class="absolute right-4 top-3 cursor-pointer">üëÅÔ∏è</span>
        </div>

        <button id="btnPhoneLogin" class="action-btn mb-2">Login</button>
      </div>

      <!-- EMAIL LOGIN -->
      <div id="formEmail" class="hidden">

        <input id="inputEmail" class="input mb-3" type="email" placeholder="Email ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®">

        <div class="relative mb-3">
          <input id="inputEmailPass" class="input pr-10" type="password" placeholder="Password">
          <span id="toggleEmailPass" class="absolute right-4 top-3 cursor-pointer">üëÅÔ∏è</span>
        </div>

        <button id="btnEmailLogin" class="action-btn mb-2">Login with Email</button>
      </div>

      <!-- GOOGLE LOGIN -->
      <div class="my-4">
        <button id="btnGoogle"
          class="w-full flex items-center justify-center gap-3 py-2 border rounded-lg bg-white">
          <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" width="20">
          Sign in with Google
        </button>
      </div>

      <div class="flex justify-between mt-2">
        <a href="signup.html" class="text-indigo-600 text-sm">‡¶∏‡¶æ‡¶á‡¶® ‡¶Ü‡¶™ ‡¶ï‡¶∞‡ßÅ‡¶®</a>
        <a href="admin-login.html" class="text-gray-600 text-sm">‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶≤‡¶ó‡¶á‡¶®</a>
      </div>

    </div>
  </div>

  <!-- FIREBASE -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { 
      getAuth, 
      signInWithEmailAndPassword, 
      GoogleAuthProvider, 
      signInWithPopup 
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

    import {
      getFirestore, collection, query, where, getDocs
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    /* Firebase Config */
    const firebaseConfig = {
      apiKey: "AIzaSyCR5rqthBh0vX0yLOcOG3b9xJiKbYtzdxU",
      authDomain: "target-zone-8fffd.firebaseapp.com",
      projectId: "target-zone-8fffd",
      storageBucket: "target-zone-8fffd.appspot.com",
      messagingSenderId: "667579216123",
      appId: "1:667579216123:web:37bb1fcc724743073d005e"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    /* Toggle UI */
    pillUID.onclick = () => {
      pillUID.classList.add("active");
      pillEmail.classList.remove("active");
      formUID.classList.remove("hidden");
      formEmail.classList.add("hidden");
    };

    pillEmail.onclick = () => {
      pillEmail.classList.add("active");
      pillUID.classList.remove("active");
      formEmail.classList.remove("hidden");
      formUID.classList.add("hidden");
    };

    toggleDob.onclick = () => inputDob.type = inputDob.type === "password" ? "text" : "password";
    toggleEmailPass.onclick = () => inputEmailPass.type = inputEmailPass.type === "password" ? "text" : "password";


    /* -----------------------------------------
       PHONE LOGIN (unchanged)
    ----------------------------------------- */
    btnPhoneLogin.onclick = async () => {
      const phone = inputPhone.value.trim();
      const dob = inputDob.value.trim();

      if (!phone || !dob) {
        Swal.fire("Error", "‡¶´‡ßã‡¶® ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶ì ‡¶ú‡¶®‡ßç‡¶Æ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ ‡¶¶‡¶ø‡¶®", "error");
        return;
      }

      try {
        const q = query(
          collection(db, "students"),
          where("phone", "==", phone),
          where("dob", "==", dob)
        );
        const snap = await getDocs(q);

        if (snap.empty) {
          Swal.fire("Login Failed", "‡¶≠‡ßÅ‡¶≤ ‡¶´‡ßã‡¶® ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶¨‡¶æ ‡¶ú‡¶®‡ßç‡¶Æ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ", "error");
          return;
        }

        const sid = snap.docs[0].id;

        Swal.fire("Success", "Login Successful!", "success");
        setTimeout(() => {
          location.href = `student-dashboard.html?sid=${sid}`;
        }, 900);

      } catch (err) {
        Swal.fire("Error", err.message, "error");
      }
    };


    /* -----------------------------------------
       EMAIL LOGIN (NEW FLOW)
    ----------------------------------------- */
    btnEmailLogin.onclick = async () => {
      try {
        const result = await signInWithEmailAndPassword(auth, inputEmail.value, inputEmailPass.value);
        const user = result.user;

        // Go to Dashboard ‚Äî Limited or Full mode decided there
        location.href = `student-dashboard.html?uid=${user.uid}&email=${user.email}`;

      } catch (err) {
        Swal.fire("Error", err.message, "error");
      }
    };


    /* -----------------------------------------
       GOOGLE LOGIN (NEW FLOW)
    ----------------------------------------- */
    btnGoogle.onclick = async () => {
      try {
        const result = await signInWithPopup(auth, new GoogleAuthProvider());
        const user = result.user;

        location.href = `student-dashboard.html?uid=${user.uid}&email=${user.email}`;

      } catch (err) {
        Swal.fire("Error", err.message, "error");
      }
    };

  </script>

</body>
</html>
