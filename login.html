<!doctype html>
<html lang="bn">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Target Zone ‚Äî Login</title>

  <!-- Tailwind CSS -->
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">

  <!-- SweetAlert -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <style>
    :root{
      --accent1:#6d28d9;
      --accent2:#8b5cf6;
    }
    body{
      font-family:"Inter",sans-serif;
      background:linear-gradient(180deg,#c7f0ff,#eaf7ff,#f6fbff);
      min-height:100vh;
      display:flex;
      justify-content:center;
      align-items:center;
      padding:30px;
    }

    .sun{
      position:fixed;
      top:5%;
      left:50%;
      transform:translateX(-50%);
      width:130px;
      height:130px;
      border-radius:50%;
      background:radial-gradient(circle,#fff7b5 0%,#ffd24f 50%,#ffb445 100%);
      box-shadow:0 10px 60px rgba(255,180,60,0.25);
      z-index:0;
    }
    .cloud{
      position:fixed;
      background:white;
      border-radius:999px;
      opacity:.8;
      filter:blur(3px);
      z-index:0;
    }
    .c1{width:240px;height:70px;top:18%;left:8%;}
    .c2{width:200px;height:60px;top:28%;right:6%;}
    .c3{width:280px;height:80px;top:35%;left:12%;opacity:.55;}

    .card{
      width:100%;
      max-width:900px;
      display:flex;
      gap:30px;
      padding:30px;
      background:rgba(255,255,255,0.85);
      backdrop-filter:blur(10px);
      box-shadow:0 20px 40px rgba(0,0,0,0.12);
      border-radius:20px;
      z-index:10;
    }

    .logo-img{
      max-width:180px;
      max-height:180px;
      object-fit:contain;
      border-radius:12px;
    }

    @media(max-width:850px){
      .card{flex-direction:column;align-items:center;text-align:center;}
    }

    .pill{padding:8px 15px;border-radius:999px;cursor:pointer;font-weight:600;}
    .pill.active{
      background:linear-gradient(90deg,var(--accent1),var(--accent2));
      color:white;
      box-shadow:0 8px 20px rgba(99,102,241,0.18);
    }

    .input{
      width:100%;
      padding:12px 14px;
      border-radius:12px;
      border:1px solid rgba(0,0,0,0.15);
      background:white;
      font-size:15px;
    }

    .action-btn{
      width:100%;
      padding:12px;
      border-radius:12px;
      color:white;
      font-size:16px;
      background:linear-gradient(90deg,var(--accent1),var(--accent2));
      font-weight:700;
    }
  </style>

</head>
<body>

  <div class="sun"></div>
  <div class="cloud c1"></div>
  <div class="cloud c2"></div>
  <div class="cloud c3"></div>

  <div class="card">

    <!-- Left Logo -->
    <div class="flex justify-center items-center w-full">
      <img class="logo-img"
        src="https://raw.githubusercontent.com/nibedansarkar12/Target_Zone/main/target-zone-high-resolution-logo-black.png">
    </div>

    <!-- Right Login Form -->
    <div class="w-full">

      <h2 class="text-2xl font-bold text-gray-800 mb-3">Target Zone ‚Äî Login</h2>

      <!-- Toggle Pills -->
      <div class="flex gap-3 mb-4">
        <div id="pillUID" class="pill active">UID Login</div>
        <div id="pillEmail" class="pill">Email Login</div>
      </div>

      <!-- UID Login Form -->
      <div id="form-uid">

        <input id="inputUid" class="input mb-3" placeholder="UID ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®">

        <div class="relative mb-3">
          <input id="inputUidPass" class="input pr-10" type="password"
            placeholder="‡¶ú‡¶®‡ßç‡¶Æ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ (YYYY-MM-DD)">
          <span id="toggleUidPass" class="absolute right-4 top-3 cursor-pointer">üëÅÔ∏è</span>
        </div>

        <button id="btnUidLogin" class="action-btn mb-2">Login with UID</button>
      </div>

      <!-- Email Login Form -->
      <div id="form-email" class="hidden">

        <input id="inputEmail" class="input mb-3" type="email" placeholder="Email ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®">

        <div class="relative mb-3">
          <input id="inputEmailPass" class="input pr-10" type="password" placeholder="Password">
          <span id="toggleEmailPass" class="absolute right-4 top-3 cursor-pointer">üëÅÔ∏è</span>
        </div>

        <button id="btnEmailLogin" class="action-btn mb-2">Login with Email</button>
      </div>

      <!-- Google -->
      <div class="my-4">
        <button id="btnGoogle"
          class="w-full flex items-center justify-center gap-3 py-2 border rounded-lg bg-white">
          <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" width="20"> Sign in with Google
        </button>
      </div>

      <div class="flex justify-between mt-2">
        <a href="signup.html" class="text-indigo-600 text-sm">‡¶∏‡¶æ‡¶á‡¶® ‡¶Ü‡¶™ ‡¶ï‡¶∞‡ßÅ‡¶®</a>
        <a href="admin-login.html" class="text-gray-600 text-sm">‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶≤‡¶ó‡¶á‡¶®</a>
      </div>

    </div>
  </div>


  <!-- Firebase Scripts -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getAuth, signInWithEmailAndPassword, GoogleAuthProvider, signInWithPopup }
      from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import { getFirestore, collection, query, where, getDocs }
      from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCR5rqthBh0vX0yLOcOG3b9xJiKbYtzdxU",
      authDomain: "target-zone-8fffd.firebaseapp.com",
      projectId: "target-zone-8fffd",
      storageBucket: "target-zone-8fffd.appspot.com",
      messagingSenderId: "667579216123",
      appId: "1:667579216123:web:37bb1fcc724743073d005e"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // Selectors
    const pillUID = document.getElementById("pillUID");
    const pillEmail = document.getElementById("pillEmail");
    const formUID = document.getElementById("form-uid");
    const formEmail = document.getElementById("form-email");

    pillUID.onclick = () => {
      pillUID.classList.add("active");
      pillEmail.classList.remove("active");
      formUID.classList.remove("hidden");
      formEmail.classList.add("hidden");
    };
    pillEmail.onclick = () => {
      pillEmail.classList.add("active");
      pillUID.classList.remove("active");
      formEmail.classList.remove("hidden");
      formUID.classList.add("hidden");
    };

    // Eye Icon ‚Äî Password Visibility
    document.getElementById("toggleUidPass").onclick = () => {
      const p = document.getElementById("inputUidPass");
      p.type = p.type === "password" ? "text" : "password";
    };
    document.getElementById("toggleEmailPass").onclick = () => {
      const p = document.getElementById("inputEmailPass");
      p.type = p.type === "password" ? "text" : "password";
    };

    // UID + DOB Login
    document.getElementById("btnUidLogin").onclick = async () => {
      const uid = inputUid.value.trim();
      const dob = inputUidPass.value.trim();

      if (!uid || !dob) {
        Swal.fire("Error", "UID ‡¶ì ‡¶ú‡¶®‡ßç‡¶Æ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®", "error");
        return;
      }

      try {
        const q = query(
          collection(db, "students"),
          where("uid", "==", uid),
          where("dob", "==", dob)
        );

        const snap = await getDocs(q);

        if (snap.empty) {
          Swal.fire("Login Failed", "‡¶≠‡ßÅ‡¶≤ UID ‡¶¨‡¶æ ‡¶ú‡¶®‡ßç‡¶Æ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ", "error");
          return;
        }

        const docId = snap.docs[0].id;
        localStorage.setItem("studentId", docId);

        Swal.fire("Success", "Login Successful!", "success");
        setTimeout(() => (location.href = "student-dashboard.html"), 900);

      } catch (err) {
        Swal.fire("Error", err.message, "error");
      }
    };

    // Email Login
    document.getElementById("btnEmailLogin").onclick = async () => {
      const email = inputEmail.value;
      const pass = inputEmailPass.value;

      if (!email || !pass) {
        Swal.fire("Error", "Email ‡¶è‡¶¨‡¶Ç Password ‡¶¶‡¶ø‡¶®", "error");
        return;
      }

      try {
        await signInWithEmailAndPassword(auth, email, pass);
        Swal.fire("Success", "Login Successful!", "success");
        setTimeout(() => (location.href = "student-dashboard.html"), 900);
      } catch (err) {
        Swal.fire("Error", err.message, "error");
      }
    };

    // Google Login
    document.getElementById("btnGoogle").onclick = async () => {
      try {
        await signInWithPopup(auth, new GoogleAuthProvider());
        Swal.fire("Success", "Google Login Successful!", "success");
        setTimeout(() => (location.href = "student-dashboard.html"), 900);
      } catch (err) {
        Swal.fire("Error", err.message, "error");
      }
    };
  </script>

</body>
</html>
