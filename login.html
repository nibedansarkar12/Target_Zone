<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Target Zone – Login</title>

<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<style>
body {
    background: linear-gradient(180deg,#c7d2fe,#e0e7ff,#ffffff);
    font-family: 'Inter', sans-serif;
}
.card {
    background: rgba(255,255,255,0.75);
    backdrop-filter: blur(15px);
    border-radius: 25px;
    padding: 25px;
    box-shadow: 0 12px 35px rgba(0,0,0,0.15);
}
.tab-active {
    background: #6d28d9 !important;
    color: white !important;
}
.googleBtn {
    border: 1px solid #ccc;
    border-radius: 12px;
    padding: 10px;
    width: 100%;
    margin-top: 12px;
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 8px;
}
</style>

</head>
<body class="p-5">

<div class="max-w-md mx-auto card mt-10">

    <!-- Logo -->
    <img src="target-zone-high-resolution-logo-black.png" class="w-40 mx-auto mb-5">

    <h2 class="text-3xl font-bold text-center text-purple-700 mb-5">Target Zone — Login</h2>

    <!-- TABS -->
    <div class="flex mb-4">
        <button id="phoneTab" class="flex-1 p-2 rounded-l-full tab-active">Phone Login</button>
        <button id="emailTab" class="flex-1 p-2 rounded-r-full bg-gray-200">Email Login</button>
    </div>

    <!-- PHONE LOGIN -->
    <div id="phoneBox">
        <input id="phone" class="w-full p-3 border rounded-lg mb-3" placeholder="Phone Number">
        <input id="dob" class="w-full p-3 border rounded-lg mb-3" placeholder="DOB (YYYY-MM-DD)">
        <button id="phoneLogin" class="w-full p-3 bg-purple-700 text-white rounded-lg font-bold">
            Login with Phone
        </button>
    </div>

    <!-- EMAIL LOGIN -->
    <div id="emailBox" class="hidden">
        <input id="email" class="w-full p-3 border rounded-lg mb-3" placeholder="Email">
        <input id="password" type="password" class="w-full p-3 border rounded-lg mb-3" placeholder="Password">
        
        <button id="emailLogin" class="w-full p-3 bg-purple-700 text-white rounded-lg font-bold">
            Login with Email
        </button>

        <button id="googleLogin" class="googleBtn">
            <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" class="w-6">
            Sign in with Google
        </button>
    </div>

    <!-- Links -->
    <div class="mt-4 flex justify-between text-sm">
        <a href="register.html" class="text-blue-700 font-semibold">সাইন আপ করুন</a>
        <a href="admin-login.html" class="text-blue-700 font-semibold">অ্যাডমিন লগইন</a>
    </div>

</div>

<!-- Firebase Logic -->
<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { 
    getAuth, signInWithEmailAndPassword, GoogleAuthProvider, signInWithPopup
} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
import { 
    getFirestore, collection, query, where, getDocs 
} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
    apiKey: "AIzaSyCR5rqthBh0vX0yLOcOG3b9xJiKbYtzdxU",
    authDomain: "target-zone-8fffd.firebaseapp.com",
    projectId: "target-zone-8fffd",
    storageBucket: "target-zone-8fffd.appspot.com",
    messagingSenderId: "667579216123",
    appId: "1:667579216123:web:37bb1fcc724743073d005e"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

/* TAB SWITCH */
emailTab.onclick = () => {
    phoneBox.classList.add("hidden");
    emailBox.classList.remove("hidden");
    phoneTab.classList.remove("tab-active");
    emailTab.classList.add("tab-active");
};

phoneTab.onclick = () => {
    phoneBox.classList.remove("hidden");
    emailBox.classList.add("hidden");
    emailTab.classList.remove("tab-active");
    phoneTab.classList.add("tab-active");
};

/* PHONE LOGIN */
phoneLogin.onclick = async () => {
    let ph = phone.value.trim();
    let db = dob.value.trim();

    const q = query(
        collection(db, "students"),
        where("phone", "==", ph),
        where("dob", "==", db)
    );

    const snap = await getDocs(q);

    if (snap.empty) {
        Swal.fire("ভুল!", "Phone বা DOB মিলছে না!", "error");
        return;
    }

    let sid = snap.docs[0].id;
    window.location.href = "student-dashboard.html?sid=" + sid;
};

/* EMAIL LOGIN */
emailLogin.onclick = async () => {
    try {
        let cred = await signInWithEmailAndPassword(auth, email.value, password.value);
        let userEmail = cred.user.email;

        const q = query(collection(db, "students"), where("linkedEmail", "==", userEmail));
        let snap = await getDocs(q);

        if (snap.empty) {
            Swal.fire("Link Required", "Dashboard-এ প্রথমবার Phone + DOB লিংক করতে হবে", "info");
            window.location.href = "student-dashboard.html";
            return;
        }

        let sid = snap.docs[0].id;
        window.location.href = "student-dashboard.html?sid=" + sid;

    } catch (err) {
        Swal.fire("Error", err.message, "error");
    }
};

/* GOOGLE LOGIN */
googleLogin.onclick = async () => {
    try {
        let provider = new GoogleAuthProvider();
        let res = await signInWithPopup(auth, provider);

        let email = res.user.email;

        const q = query(collection(db, "students"), where("linkedEmail", "==", email));
        let snap = await getDocs(q);

        if (snap.empty) {
            Swal.fire("Link Required", "Dashboard-এ প্রথমবার Phone + DOB লিংক করতে হবে", "info");
            window.location.href = "student-dashboard.html";
            return;
        }

        let sid = snap.docs[0].id;
        window.location.href = "student-dashboard.html?sid=" + sid;

    } catch (e) {
        Swal.fire("Error", e.message, "error");
    }
};

</script>

</body>
</html>
