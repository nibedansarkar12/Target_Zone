<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Target Zone – Login</title>

<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<style>
body {
    background: linear-gradient(180deg,#dbeafe,#f5f3ff,#fff);
    font-family: 'Inter', sans-serif;
}
.card {
    background: rgba(255,255,255,0.75);
    backdrop-filter: blur(12px);
    border-radius: 20px;
    padding: 25px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.15);
}
.tab-btn-active {
    background: #6d28d9;
    color: white;
}
</style>

</head>
<body class="p-5">

<div class="max-w-md mx-auto card mt-10">

    <img src="target-zone-high-resolution-logo-black.png" class="w-40 mx-auto mb-5">

    <h2 class="text-3xl font-bold mb-5 text-center text-purple-700">Target Zone — Login</h2>

    <!-- TAB BUTTONS -->
    <div class="flex mb-4">
        <button id="uidTab" class="flex-1 p-2 rounded-l-full tab-btn-active">UID Login</button>
        <button id="emailTab" class="flex-1 p-2 rounded-r-full bg-gray-200">Email Login</button>
    </div>

    <!-- UID LOGIN FORM -->
    <div id="uidLoginBox">
        <input id="uidPhone" class="w-full p-3 border rounded-lg mb-3" placeholder="Phone Number">
        <input id="uidDob" class="w-full p-3 border rounded-lg mb-3" placeholder="DOB (YYYY-MM-DD)">
        <button id="uidLoginBtn" class="w-full bg-purple-700 text-white p-3 rounded-lg">Login</button>
    </div>

    <!-- EMAIL LOGIN FORM -->
    <div id="emailLoginBox" class="hidden">
        <input id="email" class="w-full p-3 border rounded-lg mb-3" placeholder="Email">
        <input id="emailPass" class="w-full p-3 border rounded-lg mb-3" placeholder="Password" type="password">
        <button id="emailLoginBtn" class="w-full bg-purple-700 text-white p-3 rounded-lg">Login with Email</button>
    </div>

</div>

<!-- Firebase -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { 
    getAuth, signInWithEmailAndPassword 
} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
import { 
    getFirestore, collection, query, where, getDocs 
} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
    apiKey: "AIzaSyCR5rqthBh0vX0yLOcOG3b9xJiKbYtzdxU",
    authDomain: "target-zone-8fffd.firebaseapp.com",
    projectId: "target-zone-8fffd",
    storageBucket: "target-zone-8fffd.appspot.com",
    messagingSenderId: "667579216123",
    appId: "1:667579216123:web:37bb1fcc724743073d005e"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

/* ------------------------------
   TAB SWITCHING
------------------------------ */
emailTab.onclick = () => {
    uidLoginBox.classList.add("hidden");
    emailLoginBox.classList.remove("hidden");
    uidTab.classList.remove("tab-btn-active");
    emailTab.classList.add("tab-btn-active");
};
uidTab.onclick = () => {
    uidLoginBox.classList.remove("hidden");
    emailLoginBox.classList.add("hidden");
    emailTab.classList.remove("tab-btn-active");
    uidTab.classList.add("tab-btn-active");
};

/* ------------------------------
   UID LOGIN
------------------------------ */
uidLoginBtn.onclick = async () => {
    let phone = uidPhone.value.trim();
    let dob = uidDob.value.trim();

    const q = query(
        collection(db, "students"),
        where("phone", "==", phone),
        where("dob", "==", dob)
    );

    const snap = await getDocs(q);

    if (snap.empty) {
        Swal.fire("ভুল!", "Phone বা DOB ভুল!", "error");
        return;
    }

    let sid = snap.docs[0].id;

    // REDIRECT WITH SID
    window.location.href = "student-dashboard.html?sid=" + sid;
};

/* ------------------------------
   EMAIL LOGIN
------------------------------ */
emailLoginBtn.onclick = async () => {
    try {
        const user = await signInWithEmailAndPassword(auth, email.value, emailPass.value);

        // Check linking
        const q = query(collection(db, "students"), where("linkedEmail", "==", user.user.email));
        const snap = await getDocs(q);

        if (snap.empty) {
            Swal.fire("লিংক করুন", "Dashboard-এ প্রথমবার Phone + DOB লিংক করতে হবে", "info");
            window.location.href = "student-dashboard.html";
            return;
        }

        let sid = snap.docs[0].id;
        window.location.href = "student-dashboard.html?sid=" + sid;

    } catch (e) {
        Swal.fire("Error", e.message, "error");
    }
};

</script>

</body>
</html>
